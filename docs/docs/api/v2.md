# WebSocket API v2

Rabbit-Digger Pro 提供基于 WebSocket 的 JSON-RPC API 接口。所有的请求和响应都遵循 JSON-RPC 2.0 规范。

## 连接

WebSocket 连接地址: `/api/v2/ws`

## 方法

### get_config

获取当前配置。

**参数**: 无

**返回**:

- String: 当前配置内容

### post_config

设置新的配置。

**参数**:

- source: ImportSource 类型,包含新的配置信息

**返回**: null

### get_registry

获取注册表信息。

**参数**: 无

**返回**:

- Object: 注册表信息

### get_connections

获取当前所有连接。

**参数**: 无

**返回**:

- Array: 当前活跃的连接列表

### delete_connections

关闭所有连接。

**参数**: 无

**返回**:

- Number: 关闭的连接数量

### get_state

获取系统状态。

**参数**: 无

**返回**:

- String: 当前系统状态

### post_select

选择节点。

**参数**:

```typescript
{
  net_name: string; // 网络名称
  selected: string; // 选择的节点
}
```

**返回**: null

### delete_conn

删除指定连接。

**参数**:

- String: 连接 UUID

**返回**:

- Boolean: 是否成功删除

### get_delay

测试节点延迟。

**参数**:

```typescript
{
  net_name: string;     // 网络名称
  url: string;          // 测试 URL
  timeout?: number;     // 超时时间(毫秒),默认 5000
}
```

**返回**:

```typescript
{
  connect: number; // TCP 连接时间(毫秒)
  response: number; // HTTP 响应时间(毫秒)
}
```

如果测试失败返回 null。

### get_userdata

获取用户数据。

**参数**:

- String: 数据键名

**返回**:

- String: 存储的数据值

### put_userdata

存储用户数据。

**参数**:

```typescript
{
  key: string; // 数据键名
  value: string; // 数据值
}
```

**返回**:

```typescript
{
  ok: true;
}
```

### delete_userdata

删除用户数据。

**参数**:

- String: 要删除的数据键名

**返回**:

```typescript
{
  ok: true;
}
```

### list_userdata

列出所有用户数据。

**参数**: 无

**返回**:

```typescript
{
  keys: string[]  // 所有数据键名列表
}
```
