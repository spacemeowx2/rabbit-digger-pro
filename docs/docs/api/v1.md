# V1 接口 （基于 HTTP 和 WebSocket）

本文档描述了 Rabbit-Digger Pro 的 API v1 接口规范。

## 通用错误响应

当 API 调用发生错误时，会返回以下格式的错误信息：

```json
{
  "error": "错误信息描述"
}
```

状态码: 500

## 配置管理

### 获取当前配置

**GET** `/config`

获取当前运行的完整配置信息。

响应:

- Content-Type: application/json
- Body: 当前配置的 JSON 字符串

### 更新配置

**POST** `/config`

更新并重启服务使用新的配置。

请求体:

```json
{
  "type": "配置类型",
  "content": "配置内容"
}
```

响应: `null`

## 系统信息

### 获取注册表信息

**GET** `/registry`

获取所有已注册的网络类型和代理类型。

### 获取系统状态

**GET** `/state`

获取系统当前运行状态。

## 连接管理

### 获取所有连接

**GET** `/connections`

获取当前所有活动连接的信息。

### 关闭所有连接

**DELETE** `/connections`

关闭所有活动的连接。

### 关闭指定连接

**DELETE** `/connection/{uuid}`

关闭特定 UUID 的连接。

参数:

- uuid: 连接的唯一标识符

响应: 布尔值，表示操作是否成功

### WebSocket 连接监控

**WebSocket** `/connection?patch=<boolean>&without_connections=<boolean>`

通过 WebSocket 实时监控连接状态。

查询参数:

- patch: 是否使用增量更新模式
- without_connections: 是否排除详细连接信息

## 代理节点管理

### 更新代理选择

**POST** `/select/{net_name}`

更新 Select 类型代理的选择。

路径参数:

- net_name: 代理节点名称

请求体:

```json
{
  "selected": "选择的代理名称"
}
```

响应: `null`

### 测试延迟

**GET** `/delay/{net_name}?url={url}&timeout={timeout}`

测试指定代理节点的网络延迟。

路径参数:

- net_name: 代理节点名称

查询参数:

- url: 测试目标 URL
- timeout: 超时时间(毫秒)，默认 5000ms

响应:

```json
{
  "connect": "连接耗时(毫秒)",
  "response": "响应耗时(毫秒)"
}
```

## 用户数据管理

### 获取用户数据

**GET** `/userdata/{key}`

获取指定键的用户数据。

### 设置用户数据

**PUT** `/userdata/{key}`

设置指定键的用户数据。

### 删除用户数据

**DELETE** `/userdata/{key}`

删除指定键的用户数据。

### 列出所有用户数据

**GET** `/userdata`

获取所有用户数据的键列表。

响应:

```json
{
  "keys": ["key1", "key2", ...]
}
```

## 日志

### WebSocket 日志流

**WebSocket** `/log`

通过 WebSocket 实时接收系统日志。
